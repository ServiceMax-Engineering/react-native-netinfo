{"version":3,"sources":["state.ts"],"names":["NativeInterface","InternetReachability","PrivateTypes","State","configuration","_nativeEventSubscription","_subscriptions","Set","_latestState","_handleNativeStateUpdate","state","_internetReachability","update","convertedState","_convertState","forEach","handler","_handleInternetReachabilityUpdate","isInternetReachable","nextState","_fetchCurrentState","requestedInterface","getCurrentState","input","currentState","latest","Promise","resolve","add","then","remove","delete","tearDown","clear","eventEmitter","addListener","DEVICE_CONNECTIVITY_EVENT"],"mappings":"89BAUA,MAAOA,CAAAA,eAAP,KAA4B,mBAA5B,CACA,MAAOC,CAAAA,oBAAP,KAAiC,wBAAjC,CAEA,MAAO,GAAKC,CAAAA,YAAZ,KAA8B,gBAA9B,C,GAEqBC,CAAAA,K,CAMnB,eAAYC,aAAZ,CAAuD,iDAL/CC,wBAK+C,CALY,IAKZ,MAJ/CC,cAI+C,CAJ9B,GAAIC,CAAAA,GAAJ,EAI8B,MAH/CC,YAG+C,CAHL,IAGK,MAiB/CC,wBAjB+C,CAiBpB,SACjCC,KADiC,CAExB,CAET,KAAI,CAACC,qBAAL,CAA2BC,MAA3B,CAAkCF,KAAlC,EAGA,GAAMG,CAAAA,cAAc,CAAG,KAAI,CAACC,aAAL,CAAmBJ,KAAnB,CAAvB,CAGA,KAAI,CAACF,YAAL,CAAoBK,cAApB,CACA,KAAI,CAACP,cAAL,CAAoBS,OAApB,CAA4B,SAACC,OAAD,QAAmBA,CAAAA,OAAO,CAACH,cAAD,CAA1B,EAA5B,EACD,CA7BsD,MA+B/CI,iCA/B+C,CA+BX,SAC1CC,mBAD0C,CAEjC,CACT,GAAI,CAAC,KAAI,CAACV,YAAV,CAAwB,CACtB,OACD,CAED,GAAMW,CAAAA,SAAS,kBACV,KAAI,CAACX,YADK,EAEbU,mBAAmB,CAAnBA,mBAFa,EAAf,CAIA,KAAI,CAACV,YAAL,CAAoBW,SAApB,CACA,KAAI,CAACb,cAAL,CAAoBS,OAApB,CAA4B,SAACC,OAAD,QAAmBA,CAAAA,OAAO,CAACG,SAAD,CAA1B,EAA5B,EACD,CA5CsD,MA8C/CC,kBA9C+C,CA8C1B,iBAC3BC,kBAD2B,6LAGPrB,eAAe,CAACsB,eAAhB,CAAgCD,kBAAhC,CAHO,SAGrBX,KAHqB,eAM3B,KAAI,CAACC,qBAAL,CAA2BC,MAA3B,CAAkCF,KAAlC,EAEMG,cARqB,CAQJ,KAAI,CAACC,aAAL,CAAmBJ,KAAnB,CARI,CAS3B,GAAI,CAACW,kBAAL,CAAyB,CACvB,KAAI,CAACb,YAAL,CAAoBK,cAApB,CACD,CAX0B,gCAapBA,cAboB,uEA9C0B,MA8D/CC,aA9D+C,CA8D/B,SACtBS,KADsB,CAEC,CACvB,GAAI,MAAOA,CAAAA,KAAK,CAACL,mBAAb,GAAqC,SAAzC,CAAoD,CAClD,MAAOK,CAAAA,KAAP,CACD,CAFD,IAEO,CACL,wBACKA,KADL,EAEEL,mBAAmB,CAAE,KAAI,CAACP,qBAAL,CAA2Ba,YAA3B,EAFvB,GAID,CACF,CAzEsD,MA2EhDC,MA3EgD,CA2EvC,SACdJ,kBADc,CAEkB,CAChC,GAAIA,kBAAJ,CAAwB,CACtB,MAAO,CAAA,KAAI,CAACD,kBAAL,CAAwBC,kBAAxB,CAAP,CACD,CAFD,IAEO,IAAI,KAAI,CAACb,YAAT,CAAuB,CAC5B,MAAOkB,CAAAA,OAAO,CAACC,OAAR,CAAgB,KAAI,CAACnB,YAArB,CAAP,CACD,CAFM,IAEA,CACL,MAAO,CAAA,KAAI,CAACY,kBAAL,EAAP,CACD,CACF,CArFsD,MAuFhDQ,GAvFgD,CAuF1C,SAACZ,OAAD,CAA+C,CAE1D,KAAI,CAACV,cAAL,CAAoBsB,GAApB,CAAwBZ,OAAxB,EAGA,GAAI,KAAI,CAACR,YAAT,CAAuB,CACrBQ,OAAO,CAAC,KAAI,CAACR,YAAN,CAAP,CACD,CAFD,IAEO,CACL,KAAI,CAACiB,MAAL,GAAcI,IAAd,CAAmBb,OAAnB,EACD,CACF,CAjGsD,MAmGhDc,MAnGgD,CAmGvC,SAACd,OAAD,CAA+C,CAC7D,KAAI,CAACV,cAAL,CAAoByB,MAApB,CAA2Bf,OAA3B,EACD,CArGsD,MAuGhDgB,QAvGgD,CAuGrC,UAAY,CAC5B,GAAI,KAAI,CAACrB,qBAAT,CAAgC,CAC9B,KAAI,CAACA,qBAAL,CAA2BqB,QAA3B,GACD,CAED,GAAI,KAAI,CAAC3B,wBAAT,CAAmC,CACjC,KAAI,CAACA,wBAAL,CAA8ByB,MAA9B,GACD,CAED,KAAI,CAACxB,cAAL,CAAoB2B,KAApB,GACD,CAjHsD,CAErD,KAAKtB,qBAAL,CAA6B,GAAIV,CAAAA,oBAAJ,CAC3BG,aAD2B,CAE3B,KAAKa,iCAFsB,CAA7B,CAMA,KAAKZ,wBAAL,CAAgCL,eAAe,CAACkC,YAAhB,CAA6BC,WAA7B,CAC9BjC,YAAY,CAACkC,yBADiB,CAE9B,KAAK3B,wBAFyB,CAAhC,CAMA,KAAKW,kBAAL,GACD,C,QArBkBjB,K","sourcesContent":["/**\r\n * Copyright (c) Facebook, Inc. and its affiliates.\r\n *\r\n * This source code is licensed under the MIT license found in the\r\n * LICENSE file in the root directory of this source tree.\r\n *\r\n * @format\r\n */\r\n\r\nimport {NativeEventSubscription} from 'react-native';\r\nimport NativeInterface from './nativeInterface';\r\nimport InternetReachability from './internetReachability';\r\nimport * as Types from './types';\r\nimport * as PrivateTypes from './privateTypes';\r\n\r\nexport default class State {\r\n  private _nativeEventSubscription: NativeEventSubscription | null = null;\r\n  private _subscriptions = new Set<Types.NetInfoChangeHandler>();\r\n  private _latestState: Types.NetInfoState | null = null;\r\n  private _internetReachability: InternetReachability;\r\n\r\n  constructor(configuration: Types.NetInfoConfiguration) {\r\n    // Add the listener to the internet connectivity events\r\n    this._internetReachability = new InternetReachability(\r\n      configuration,\r\n      this._handleInternetReachabilityUpdate,\r\n    );\r\n\r\n    // Add the subscription to the native events\r\n    this._nativeEventSubscription = NativeInterface.eventEmitter.addListener(\r\n      PrivateTypes.DEVICE_CONNECTIVITY_EVENT,\r\n      this._handleNativeStateUpdate,\r\n    );\r\n\r\n    // Fetch the current state from the native module\r\n    this._fetchCurrentState();\r\n  }\r\n\r\n  private _handleNativeStateUpdate = (\r\n    state: PrivateTypes.NetInfoNativeModuleState,\r\n  ): void => {\r\n    // Update the internet reachability module\r\n    this._internetReachability.update(state);\r\n\r\n    // Convert the state from native to JS shape\r\n    const convertedState = this._convertState(state);\r\n\r\n    // Update the listeners\r\n    this._latestState = convertedState;\r\n    this._subscriptions.forEach((handler): void => handler(convertedState));\r\n  };\r\n\r\n  private _handleInternetReachabilityUpdate = (\r\n    isInternetReachable: boolean | null | undefined,\r\n  ): void => {\r\n    if (!this._latestState) {\r\n      return;\r\n    }\r\n\r\n    const nextState = {\r\n      ...this._latestState,\r\n      isInternetReachable,\r\n    } as Types.NetInfoState;\r\n    this._latestState = nextState;\r\n    this._subscriptions.forEach((handler): void => handler(nextState));\r\n  };\r\n\r\n  private _fetchCurrentState = async (\r\n    requestedInterface?: string,\r\n  ): Promise<Types.NetInfoState> => {\r\n    const state = await NativeInterface.getCurrentState(requestedInterface);\r\n\r\n    // Update the internet reachability module\r\n    this._internetReachability.update(state);\r\n    // Convert and store the new state\r\n    const convertedState = this._convertState(state);\r\n    if (!requestedInterface) {\r\n      this._latestState = convertedState;\r\n    }\r\n\r\n    return convertedState;\r\n  };\r\n\r\n  private _convertState = (\r\n    input: PrivateTypes.NetInfoNativeModuleState,\r\n  ): Types.NetInfoState => {\r\n    if (typeof input.isInternetReachable === 'boolean') {\r\n      return input as Types.NetInfoState;\r\n    } else {\r\n      return {\r\n        ...input,\r\n        isInternetReachable: this._internetReachability.currentState(),\r\n      } as Types.NetInfoState;\r\n    }\r\n  };\r\n\r\n  public latest = (\r\n    requestedInterface?: string,\r\n  ): Promise<Types.NetInfoState> => {\r\n    if (requestedInterface) {\r\n      return this._fetchCurrentState(requestedInterface);\r\n    } else if (this._latestState) {\r\n      return Promise.resolve(this._latestState);\r\n    } else {\r\n      return this._fetchCurrentState();\r\n    }\r\n  };\r\n\r\n  public add = (handler: Types.NetInfoChangeHandler): void => {\r\n    // Add the subscription handler to our set\r\n    this._subscriptions.add(handler);\r\n\r\n    // Send it the latest data we have\r\n    if (this._latestState) {\r\n      handler(this._latestState);\r\n    } else {\r\n      this.latest().then(handler);\r\n    }\r\n  };\r\n\r\n  public remove = (handler: Types.NetInfoChangeHandler): void => {\r\n    this._subscriptions.delete(handler);\r\n  };\r\n\r\n  public tearDown = (): void => {\r\n    if (this._internetReachability) {\r\n      this._internetReachability.tearDown();\r\n    }\r\n\r\n    if (this._nativeEventSubscription) {\r\n      this._nativeEventSubscription.remove();\r\n    }\r\n\r\n    this._subscriptions.clear();\r\n  };\r\n}\r\n"]}